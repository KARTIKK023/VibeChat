services:
  - type: web
    name: chat-app
    env: node
    plan: free

    # ✅ Force Node 20 (better compatibility for Vite)
    envVars:
      - key: NODE_VERSION
        value: 20
      - key: NODE_ENV
        value: production

    # ✅ Build phase (override NODE_ENV to include devDependencies)
    buildCommand: |
      export NODE_ENV=development
      npm install --prefix backend
      npm install --prefix frontend
      npm run build --prefix frontend

    # ✅ Start phase (use backend which serves frontend)
    startCommand: npm run start --prefix backend

     